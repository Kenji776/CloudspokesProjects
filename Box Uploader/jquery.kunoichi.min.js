var detailsWindowTimer,detailsWindow,uploadResult,interval;
(function(b){b.fn.kunoichi=function(c){var a=b.extend({cookieName:"Kunoichi",spinnerImage:"shuriken_grey_bg.png",apiKey:"j19t7wyi9cjxrqcfquhfe9wnyb9z01qk",boxUploadUrl:"https://upload.box.net/api/1.0/upload",boxUserAuthUrl:"https://m.box.net/api/1.0/auth/",ticket:null,token:null,folderId:0,uploadComplete:null,error:null},c);return this.each(function(){try{b.fn.kunoichi.settings=a,b.fn.kunoichi.settings.form=this,b("#"+this.id+" :submit").after('<div class="kunoichi_loader_container" style="display:inline-block;display:none;"><img src="'+a.spinnerImage+
'"  class="kunoichi_loader" style="display:none;margin-left:10px;display:inline-block;vertical-align:middle;margin-top:-5px;" /><label style="display:inline-block">Uploading Please Wait</label></div><div style="clear:both"></div>'),b("#"+this.id+" :submit").button("disable"),b("#"+a.form.id+" :file").change(function(){b("#"+a.form.id+" :submit").button("enable")}),b(this).hide(),b("#"+this.id+" :submit").click(function(c){c.preventDefault();b.fn.kunoichi.uploadFile(a.folderId)}),null==a.token&&(a.token=
b.cookie(a.cookieName)),null==a.token?b.getJSON("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%20%3D%20'https%3A%2F%2Fwww.box.net%2Fapi%2F1.0%2Frest%3Faction%3Dget_ticket%26api_key%3D"+a.apiKey+"'&format=json&diagnostics=true&callback=?",function(c){a.ticket=c.query.results.response.ticket;detailsWindow=window.open(a.boxUserAuthUrl+a.ticket,"BoxTicketUrl");detailsWindow.focus();detailsWindowTimer=setInterval(function(a){if(!detailsWindow||detailsWindow.closed)clearInterval(detailsWindowTimer),
b.fn.kunoichi.getAuthToken(a)},200)}):null!=a.token&&(b.cookie(a.cookieName,a.token,{path:"/"}),b(this).show())}catch(c){jQuery.isFunction(a.error)&&a.error(c)}})}})(jQuery);
$.fn.kunoichi.getAuthToken=function(){var b=$.fn.kunoichi.settings;try{$.getJSON("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%20%3D%20'https%3A%2F%2Fwww.box.net%2Fapi%2F1.0%2Frest%3Faction%3Dget_auth_token%26ticket%3D"+b.ticket+"%26api_key%3D"+b.apiKey+"'&format=json&diagnostics=true&callback=?",function(a){try{if(a.query.results.hasOwnProperty("response"))if($.cookie(b.cookieName,a.query.results.response.auth_token,{path:"/"}),b.token=a.query.results.response.auth_token,
null!=b.token)$(b.form).show();else throw Error("Authentication Failed");else throw Error("Authentication Failed");}catch(c){jQuery.isFunction(b.error)&&b.error(c)}})}catch(c){jQuery.isFunction(b.error)&&b.error(c)}};
$.fn.kunoichi.uploadFile=function(b){var c=$.fn.kunoichi.settings;try{$.fn.kunoichi.ajaxSpinner(!0);upload_url=c.boxUploadUrl+"/"+c.token+"/"+b;var a=$("#"+c.form.id+" :file")[0],d=$(a).val().split("\\"),e=d[d.length-1];null==e&&(e=$(".customfile-feedback-populated").text());var g=$('<iframe id="upload_iframe" width="0" height="0" border="0" style="width: 0; height: 0; border: none;"></iframe>');$("body").append(g);var f=$('<form method="post" enctype="multipart/form-data" action="'+upload_url+'">');
f.append(a);g.contents().find("body").append(f);f.submit();uploadResult=setInterval(function(){try{void 0==document.getElementById("upload_iframe").contentWindow.location.href&&(window.clearInterval(uploadResult),$.fn.kunoichi.getUploadedFile(e,b,function(a){jQuery.isFunction(c.uploadComplete)&&($.fn.kunoichi.ajaxSpinner(!1),c.uploadComplete(a))}))}catch(a){$.fn.kunoichi.ajaxSpinner(!1),jQuery.isFunction(c.error)&&c.error(a)}},200)}catch(h){jQuery.isFunction(c.error)&&c.error(h)}};
$.fn.kunoichi.getUploadedFile=function(b,c,a){var d=$.fn.kunoichi.settings;try{$.getJSON("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%20%3D%20'https%3A%2F%2Fwww.box.net%2Fapi%2F1.0%2Frest%3Faction%3Dget_account_tree%26folder_id%3D"+c+"%26auth_token%3D"+d.token+"%26api_key%3D"+d.apiKey+"%26params%5B%5D%3Donelevel%26params%5B%5D%3Dnozip'&format=json&diagnostics=true&callback=?",function(c){console.log(c);$.isArray(c.query.results.response.tree.folder.files.file)?
$.each(c.query.results.response.tree.folder.files.file,function(c,d){d.file_name==b&&a(d)}):c.query.results.response.tree.folder.files.file.file_name==b&&a(c.query.results.response.tree.folder.files.file)})}catch(e){a(e)}};
$.fn.kunoichi.setFileDescription=function(b,c,a){var d=$.fn.kunoichi.settings;try{$.getJSON("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%20%3D%20'https%3A%2F%2Fwww.box.net%2Fapi%2F1.0%2Frest%3Faction%3Dset_description%26target%3Dfile%26target_id%3D"+b+"%26description%3D"+encodeURIComponent(c.split(" ").join("+"))+"%26auth_token%3D"+d.token+"%26api_key%3D"+d.apiKey+"'&format=json&diagnostics=true&callback=?",function(b){a(b.query)})}catch(e){a(e)}};
$.fn.kunoichi.ajaxSpinner=function(b){b?($(".kunoichi_loader_container").show(),$(".kunoichi_loader_container").css("display","inline-block"),$(".kunoichi_loader").each(function(){var b=null,a=0,d=$(this);clearInterval(b);b=setInterval(function(){a-=2.2;d.css({MozTransform:"rotate(-"+-a+"deg)",WebkitTransform:"rotate("+-a+"deg)",transform:"rotate("+-a+"deg)"})},1)})):($(".kunoichi_loader_container").hide(),$(".kunoichi_loader").each(function(){clearInterval(interval)}))};