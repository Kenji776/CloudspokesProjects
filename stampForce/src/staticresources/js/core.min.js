var refreshEvents=!0;$(window).bind("load",function(){userData.id!=void 0&&$.mobile.changePage("#events")});var userData={},eventData={},eventId,attendeeId;function setEventId(a){eventId=a}function setAttendeeId(a){attendeeId=a}
$(document).ready(function(){$.cookie("stampForceUser")!=null&&(userData=jQuery.parseJSON($.cookie("stampForceUser")),$("#login-email").val(userData.email));$(".footer").html('<h4>Stampforce by Appirio & Kenji776<br><a href="#signup">Register</a> | <a href="#login">Login</a></h4>');$("#signup-submit").click(function(){signupUser()});$("#login-submit").click(function(){loginUser()});$("#forgotPassword-submit").click(function(){forgotPassword()});$("#create-submit").click(function(){createStampCode()});
$("#redeem-submit").click(function(){redeemStampCode($("#redeem-code").val())});$("#register-submit").click(function(){registerForEvent()});$("#give-submit").click(function(){giveStamp()});$("#events").live("pageshow",function(){refreshEvents&&(getUserEvents(function(){getEvents()}),refreshEvents=!1)});$("#stamps").live("pageshow",function(){getStamps()});$("#qrCode").live("pageshow",function(){$("#qrCodeText").html(userData.events[eventId].Name);$("#qrcode").qrcode(userData.events[eventId].Name)});
$("#register").live("pageshow",function(){var a=eventData[eventId].Start__c,d=eventData[eventId].End__c,a=dateFormat(a,"ddd mmm dS h:MM TT"),d=dateFormat(d,"h:MM TT"),a='<span class="title">'+eventData[eventId].Title__c+'</span><span class="title">'+a+" - "+d+"</span><p>"+$("#address-"+eventId).html()+"</p><p>"+$("#description-"+eventId).html()+"</p>";$("#registerData").html(a)});$("#createStamp").live("pageshow",function(){$("#createCompanyName").html(userData.companyName)});$(".dataForm").validate()});
function writeCookie(){var a=JSON.stringify(userData);$.cookie("stampForceUser",a,{expires:7})}function signupUser(){if($("#signup-form").valid()){$.mobile.showPageLoadingMsg();var a=$("#signup-form").serialize();stampForce.registerUser(a,function(a,c){c.status&&(a.success==!0||a.success=="true"?$.mobile.changePage("#signup-success"):$("#signupResult").html(a.message+". "+a.data),$.mobile.hidePageLoadingMsg())},{escape:!0})}}
function registerForEvent(){$.mobile.showPageLoadingMsg();$("#regiserResult").html(null);stampForce.registerUserForEvent(userData.id,eventId,function(a,d){d.status&&(a.success==!0||a.success=="true"?($("#events-list").html(null),refreshEvents=!0,$("#regiserResult").html('You have succesfully registered for this event! You may now being collecting stamps. <a href="#events">Continue</a>'),$.mobile.changePage("#events")):$("#regiserResult").html(a.message+". "+a.data),$.mobile.hidePageLoadingMsg())},
{escape:!0})}function createStampCode(){$.mobile.showPageLoadingMsg();$("#getResult").html(null);stampForce.createStampCode(userData.company,userData.id,eventId,function(a,d){d.status&&(a.success==!0||a.success=="true"?($("#createStampOutput").html(a.message+". "+a.data),eventData[eventId].Enable_QR_Codes__c&&$("#qrcodeGen").qrcode(a.data)):$("#createStampOutput").html(a.message+". "+a.data),$.mobile.hidePageLoadingMsg())},{escape:!0})}
function redeemStampCode(a){$("#redeem-form").valid()&&($.mobile.showPageLoadingMsg(),stampForce.redeemStampCode(attendeeId,eventId,a,function(a,c){c.status&&(a.success==!0||a.success=="true"?($("#redeemStampOutput").html(a.message+". "+a.data),$.mobile.changePage("#stamps")):$("#redeemStampOutput").html(a.message+". "+a.data),$.mobile.hidePageLoadingMsg())},{escape:!0}))}
function giveStamp(){if($("#give-form").valid()){var a=$("#give-code").val();$.mobile.showPageLoadingMsg();stampForce.giveStampToAttendee(a,userData.id,userData.company,function(a,c){c.status&&($("#giveStampOutput").html(a.message+". "+a.data),$.mobile.hidePageLoadingMsg())},{escape:!0})}}
function getStamps(){$.mobile.showPageLoadingMsg();$("#getResult").html(null);stampForce.getStamps(userData.id,eventId,function(a,d){if(d.status){if(a.success==!0||a.success=="true"){if(a.sObjects.length>0){var c="<table class='dataTable'>";c+="<tr><th>Stamp Provided By</th><th>Sponsor Location</th><th>Required Action</th><th>Stamp</th>";for(var b=0;b<a.sObjects.length;b++)c+="<tr><td>"+a.sObjects[b].Sponsor__r.Company__r.Name+"</td><td>"+a.sObjects[b].Sponsor__r.Location_Description__c+"</td><td>"+
a.sObjects[b].Sponsor__r.Stamp_Action_Description__c+"</td>",c+=a.sObjects[b].Status__c=="Generated"?"<td><img src="+a.sObjects[b].Event__r.Missing_Stamp_Image__c+" /></td>":a.sObjects[b].Sponsor__r.Stamp_Image_URL__c.length>1?"<td><img src="+a.sObjects[b].Sponsor__r.Stamp_Image_URL__c+" /></td>":"<td><img src="+a.sObjects[b].Event__r.Default_Stamp_Image__c+" /></td>";c+="</tr></table>"}else c="<p>Awww, you don't have any stamps. Bummer. You should go collect some!</p>";$("#stampList").html(c);getUserEvents(function(){})}else $("#getResult").html(a.message+
". "+a.data);$.mobile.hidePageLoadingMsg()}},{escape:!0})}
function loginUser(){if($("#login-form").valid()){$.mobile.showPageLoadingMsg();$("#loginResult").html(null);var a=$("#login-form").serialize();refreshEvents=!0;$("#events-list").html(null);stampForce.loginUser(a,function(a,c){if(c.status)a.success==!0||a.success=="true"?(userData.email=a.sObjects[0].Email__c,userData.phone=a.sObjects[0].Phone__c,userData.company=a.sObjects[0].Company__c,userData.id=a.sObjects[0].Id,userData.type=a.sObjects[0].Type__c,userData.companyName=a.sObjects[0].Company__r.Name,
userData.code=a.sObjects[0].Name,writeCookie(),userData.type=="Sponsor"?$.mobile.changePage("#createStamp"):$.mobile.changePage("#events")):$("#loginResult").html(a.message+". "+a.data),$.mobile.hidePageLoadingMsg()},{escape:!0})}}
function getEvents(){$.mobile.showPageLoadingMsg();$("#events-list").html(null);stampForce.getEvents(function(a,d){if(d.status){var c="";eventData=a.sObjectMap;if(a.success==!0||a.success=="true"){for(var b=0;b<a.sObjects.length;b++){var e=null,e=userData.events[a.sObjects[b].Id]!=void 0?userData.events[a.sObjects[b].Id].Id:null,f=a.sObjects[b].Start__c,g=a.sObjects[b].End__c,f=dateFormat(f,"ddd mmm dS h:MM TT"),g=dateFormat(g,"h:MM TT");c+='<div data-role="collapsible" data-collapsed="true" id="event-'+
a.sObjects[b].Id+'"><h3>'+a.sObjects[b].Title__c+' <span style="float:right;"> '+f+" - "+g+"</span></h3><p>";if(userData.type=="Sponsor"||userData.type=="Admin")c+='<a href="#createStamp" onClick="setEventId(\''+a.sObjects[b].Id+"');\">Generate Code</a> |",c+='<a href="#giveStamp" onClick="setEventId(\''+a.sObjects[b].Id+"');\">Give Stamp</a> |";(userData.type=="User"||userData.type=="Admin")&&e!=null?(c+='<a href="#stamps" onClick="setEventId(\''+a.sObjects[b].Id+"');setAttendeeId('"+e+"');\" >View Stamps</a> | ",
c+='<a href="#addStamp" onClick="setEventId(\''+a.sObjects[b].Id+"'); setAttendeeId('"+e+"');\">Redeem Stamp Code</a> | ",a.sObjects[b].Enable_QR_Codes__c&&(c+='<a href="#qrCode" onClick="setEventId(\''+a.sObjects[b].Id+"'); setAttendeeId('"+e+"');\">Attendee QR Code</a>")):c+='<a href="#register" onClick="setEventId(\''+a.sObjects[b].Id+"')\" >Register for this Event</a> ";c+='</p><p id ="address-'+a.sObjects[b].Id+'">Location: '+a.sObjects[b].Address__c+", "+a.sObjects[b].City__c+", "+a.sObjects[b].State__c+
" "+a.sObjects[b].Postal_Code__c+'</p><p id ="description-'+a.sObjects[b].Id+'">'+a.sObjects[b].Description__c+"</p></div>"}$("#events-list").html(c);$("#events").page("destroy").page()}else $("#event-list").html(a.message+". "+a.data);$.mobile.hidePageLoadingMsg()}},{escape:!0})}function getUserEvents(a){stampForce.getUsersRegisteredEvents(userData.id,function(d,c){if(c.status){if(d.success==!0||d.success=="true")userData.events={},userData.events=d.sObjectMap,writeCookie();a()}},{escape:!0})};